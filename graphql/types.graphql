scalar DateTime

scalar Json

enum BoardPicture {
  NORTHERN_LIGHTS
  DENALI
  FOX
  PUFFIN
  TREETOPS
}

# Payload returned after signing up
type signUpPayload {
  # token used to authenticate, pass it as a bearer in the authentication header
  token: String!
  user: User!
}

# Payload returned when authenticating
type logInPayload {
  # token used to authenticate, pass it as a bearer in the authentication header
  token: String!
  user: User!
}

# Data needed to display the QR code when upgrading to 2-Factor Authentication
# type UpgradeTo2FactorPayload {
#   # totp secret
#   secret: String
#   # svg for the qr code
#   qrCode: String
# }

enum Role {
  ADMIN
  EDITOR
  SPECTATOR
}

enum LengthAndMass {
  SI
  IMPERIAL
}

enum Temperature {
  CELSIUS
  FARENHEIT
  KELVIN
}

enum DateFormat {
  DMY
  MDY
  YMD
  YDM
}

enum TimeFormat {
  H24
  H12
}

enum TokenType {
  DELETE_USER
  CHANGE_EMAIL
  GENERATE_PERMANENT_TOKEN
  CHANGE_PASSWORD
}

# All available mutations
type Mutation {
  # Gets an authentication token
  logIn(email: String!, password: String!): logInPayload

  # creates a token to perform special operations
  createToken(password: String!, tokenType: TokenType!): String

  # Generates a permanent access token
  createPermanentAccessToken(
    name: String! # name of the token
  ): logInPayload

  # removes a permanent access token
  deletePermanentAccesToken(id: ID!): ID

  # Creates a new account
  signUp(email: String!, password: String!, name: String!): signUpPayload

  # Sends an email with a llink to change the password
  sendPasswordRecoveryEmail(email: String!): Boolean

  # Upgrades a user to 2 factor authentication
  # UpgradeTo2FactorAuthentication: UpgradeTo2FactorPayload

  # Changes the password of the authenticated user
  changePassword(newPassword: String!): logInPayload

  resendVerificationEmail: Boolean

  shareBoard(boardId: ID!, email: String!, role: Role!): PendingBoardShare
  pendingBoardShare(id: ID!, role: Role!): PendingBoardShare
  # returns the ID of the pending share that was revoked
  revokePendingBoardShare(pendingBoardShareId: ID!): ID

  # returns the ID of the accepted board
  acceptPendingBoardShare(pendingBoardShareId: ID!): ID
  # returns the ID of the accepted board
  declinePendingBoardShare(pendingBoardShareId: ID!): ID

  stopSharingBoard(boardId: ID!, email: String!): Board
  leaveBoard(boardId: ID!): ID

  changeOwner(boardId: ID!, email: String!): PendingOwnerChange
  # returns the ID of the pending share that was revoked
  revokePendingOwnerChange(pendingOwnerChangeId: ID!): ID

  # returns the ID of the accepted board
  acceptPendingOwnerChange(pendingOwnerChangeId: ID!): ID
  # returns the ID of the accepted board
  declinePendingOwnerChange(pendingOwnerChangeId: ID!): ID

  changeRole(boardId: ID!, email: String!, newRole: Role!): Board

  # Creates a Board
  createBoard(
    name: String!
    avatar: BoardPicture
    index: Int
    muted: Boolean
  ): Board

  # Creates a new Device
  createDevice(
    # Product name, for example Igloo Thermostat
    deviceType: String
    # Custom name gave by the end-user to the device
    name: String!
    # used to sort the devices in Igloo Aurora
    index: Int
    signalStatus: Float
    batteryStatus: Float
    batteryCharging: Boolean
    boardId: ID!
    firmware: String
    muted: Boolean
  ): Device

  # Creates a new notification
  createNotification(
    # device associated with the notification
    deviceId: ID!
    content: String! # optional if you want to change the date # date: DateTime
    date: DateTime
  ): Notification

  # Creates a new FloatValue
  createFloatValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    value: Float!
    # used when displaying or changing the value in Igloo Aurora
    precision: Float
    # [min, max]
    boundaries: [Float!]
    # name of the value, displayed in Igloo Aurora
    name: String!
    # tile size in Igloo Aurora
    tileSize: TileSize
    index: Int
  ): FloatValue

  # Creates a StringValue
  createStringValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    value: String!
    # max length of the string
    maxChars: Int
    # name of the value, displayed in Igloo Aurora
    name: String!
    # tile size in Igloo Aurora
    tileSize: TileSize
    # allowed values for the string
    allowedValues: [String!]
    index: Int
  ): StringValue

  # Creates a BooleanValue
  createBooleanValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    value: Boolean!
    # name of the value, displayed in Igloo Aurora
    name: String!
    # tile size in Igloo Aurora
    tileSize: TileSize
    index: Int
  ): BooleanValue

  # Creates a MapValue
  createMapValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    # name of the value, displayed in Igloo Aurora
    name: String!
    # tile size in Igloo Aurora
    tileSize: TileSize
    # GEOJson string
    value: String
    latitude: Float
    longitude: Float
    height: Float
    index: Int
  ): MapValue

  # Creates a new PlotValue
  createPlotValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    # used when the end-user reads or modifies the value
    precision: Float
    # [min, max]
    boundaries: [Float!]
    # name of the value, displayed in Igloo Aurora
    name: String!
    # tile size in Igloo Aurora
    tileSize: TileSize
    # alert threshold, values above the threshold will be displayed in red in Igloo Aurora
    threshold: Float
    index: Int
  ): PlotValue

  # Creates a new node in a plot
  createPlotNode(
    # id of the parent plot
    plotId: ID!
    # default is now
    timestamp: DateTime
    value: Float!
  ): PlotNode

  # Creates a new PlotValue
  createStringPlotValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    # name of the value, displayed in Igloo Aurora
    name: String!
    # tile size in Igloo Aurora
    tileSize: TileSize
    # allowed labels
    allowedValues: [String!]
    index: Int
  ): StringPlotValue

  # Creates a new node in a plot
  createStringPlotNode(
    # id of the parent plot
    plotId: ID!
    # default is now
    timestamp: DateTime
    value: String!
  ): StringPlotNode

  # Change user's data
  user(
    quietMode: Boolean
    devMode: Boolean
    usageCap: Int
    paymentPlan: PaymentPlan
    name: String
    profileIcon: String
    profileIconColor: String
  ): User
  changeEmail(newEmail: String!): Boolean

  settings(
    timeZone: String
    language: String
    lengthAndMass: LengthAndMass
    temperature: Temperature
    dateFormat: DateFormat
    timeFormat: TimeFormat
  ): Settings

  updatePaymentInfo(stripeToken: String!): Boolean

  # changes board's data
  board(
    id: ID!
    name: String
    avatar: BoardPicture
    index: Int
    muted: Boolean
  ): Board

  # changes device's data
  device(
    # device id
    id: ID!
    # Product name, for example Igloo Thermostat
    deviceType: String
    # Custom name gave by the end-user to the device
    name: String
    # used to sort the devices in Igloo Aurora
    index: Int
    signalStatus: Float
    batteryStatus: Float
    batteryCharging: Boolean
    firmware: String
    muted: Boolean
  ): Device

  moveDevice(deviceId: ID!, newBoardId: ID!): Device

  resetOnlineState(deviceId: ID!): Device

  # changes floatValue's data
  floatValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    value: Float
    # used when displaying or changing the value in Igloo Aurora
    precision: Float
    # [min, max]
    boundaries: [Float!]
    # name of the value, displayed in Igloo Aurora
    name: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    index: Int
  ): FloatValue

  incrementFloatValue(id: ID!, incrementBy: Float!): FloatValue

  # changes stringValue's data
  stringValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    value: String
    # max length of the string
    maxChars: Int
    # name of the value, displayed in Igloo Aurora
    name: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # allowed values for the string
    allowedValues: [String!]
    index: Int
  ): StringValue

  # changes booleanValue's data
  booleanValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    value: Boolean
    # name of the value, displayed in Igloo Aurora
    name: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    index: Int
  ): BooleanValue

  # changes mapValue's data
  mapValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    # name of the value, displayed in Igloo Aurora
    name: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # GEOJson string
    value: String
    latitude: Float
    longitude: Float
    height: Float
    index: Int
  ): MapValue

  # changes plotValue's data
  plotValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    # used when the end-user reads or modifies the value
    precision: Float
    # [min, max]
    boundaries: [Float!]
    # name of the value, displayed in Igloo Aurora
    name: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # alert threshold, values above the threshold will be displayed in red in Igloo Aurora
    threshold: Float
    index: Int
  ): PlotValue

  # change plotNode's data
  plotNode(
    # node's id
    id: ID!
    # node's value
    value: Float
    # node's timestamp
    timestamp: DateTime
  ): PlotNode

  # changes StringPlotValue's data
  stringPlotValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    visibility: ValueVisibility
    # additional details about the value
    valueDetails: String
    # name of the value, displayed in Igloo Aurora
    name: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # allowed labels
    allowedValues: [String!]
    index: Int
  ): PlotValue

  # change StringPlotNode's data
  stringPlotNode(
    # node's id
    id: ID!
    # node's value
    value: String
    # node's timestamp
    timestamp: DateTime
  ): StringPlotNode

  # change notification's data
  notification(
    # notification's id
    id: ID!
    # notification's content
    content: String
    # notification's date
    date: DateTime
    # whether the notification has already been visualized
    visualized: Boolean
  ): Notification

  # delete notification
  deleteNotification(id: ID!): ID
  # delte value
  deleteValue(id: ID!): ID
  # delete device
  deleteDevice(id: ID!): ID
  # delete board
  deleteBoard(id: ID!): ID
  # delte user
  deleteUser: ID
  # delte plot node
  deletePlotNode(id: ID!): ID
  # delte string plot node
  deleteStringPlotNode(id: ID!): ID
}

input DeviceFilter {
  OR: [DeviceFilter!]
  AND: [DeviceFilter!]
  name: String
  deviceType: String
}

type Query {
  # gets user's data
  user: User
  #  get's device's data
  device(id: ID!): Device
  # get's board's data
  board(id: ID!): Board
  # get's value's data
  value(id: ID!): Value
  # get notification's data
  notification(id: ID!): Notification
  # get plotNode's data
  plotNode(id: ID!): PlotNode
  # get stringPlotNode's data
  stringPlotNode(id: ID!): StringPlotNode
}

type Subscription {
  # subscribes to device creations
  deviceCreated: Device
  # subscribes to board creations
  boardCreated: Board
  # subscribes to value creations
  valueCreated: Value
  # subscribes to plot node creations
  plotNodeCreated: PlotNode
  # subscribes to string plot node creations
  stringPlotNodeCreated: StringPlotNode
  #subscribes to token creations
  permanentTokenCreated: PermanentToken
  # subscribes to notification creations
  notificationCreated: Notification
  # subscribes to device creations
  deviceMoved: Device
  # subscribes to board shares to you
  boardSharedWithYou: PendingBoardShare
  # returns the id of the board accepted
  boardShareAccepted: ID
  # returns the id of the board declined
  boardShareDeclined: ID
  # returns the id of the board share that was revoked
  boardShareRevoked: ID
  # subscribes to owner change to you
  ownerChangeBegan: PendingOwnerChange
  # returns the id of the board accepted
  ownerChangeAccepted: ID
  # returns the id of the board declined
  ownerChangeDeclined: ID
  # returns the id of the owner change that was revoked
  ownerChangeRevoked: ID
  # subscribes to board unshares from you or you leave a board
  boardStoppedSharingWithYou: ID
  # subscribes to value updates
  userUpdated: User
  # subscribes to device updates
  deviceUpdated: Device
  # subscribes to board updates
  boardUpdated: Board
  # subscribes to value updates
  valueUpdated: Value
  # subscribes to plot node updates
  plotNodeUpdated: PlotNode
  # subscribes to plot node updates
  stringPlotNodeUpdated: StringPlotNode
  # subscribes to notification updates
  notificationUpdated: Notification
  # subscribes to value deleted
  valueDeleted: ID
  # subscribes to plot node deletes
  plotNodeDeleted: ID
  # subscribes to plot node deletes
  stringPlotNodeDeleted: ID
  # subscribes to device deletes
  deviceDeleted: ID
  # subscribes to board deletes
  boardDeleted: ID
  # subscribes to user deletes
  userDeleted: ID
  # subscribes to token deletes
  permanentTokenDeleted: ID
  # subscribes to notification deletes
  notificationDeleted: ID
  # keeps the device's status set as online
  keepOnline(deviceId: ID!): Boolean
}

enum PaymentPlan {
  FREE
  PAYING
}

type Settings {
  lengthAndMass: LengthAndMass!
  temperature: Temperature!
  timeFormat: TimeFormat!
  dateFormat: DateFormat!
  language: String!
  timeZone: String!
}

type User {
  id: ID!
  email: String!
  pendingBoardShareCount: Int!
  pendingBoardShares: [PendingBoardShare!]!
  pendingOwnerChangeCount: Int!
  pendingOwnerChanges: [PendingOwnerChange!]!
  boardCount: Int!
  boards: [Board!]!
  deviceCount: Int
  devices: [Device!]!
  valueCount: Int!
  values: [Value!]!
  notifications: [Notification!]!
  notificationCount: Int!
  permanentTokenCount: Int!
  permanentTokens: [PermanentToken!]!
  quietMode: Boolean
  devMode: Boolean
  monthUsage: Int
  paymentPlan: PaymentPlan
  usageCap: Int
  name: String
  profileIcon: String
  profileIconColor: String
  emailIsVerified: Boolean
  settings: Settings!
}

enum RoleExtended {
  OWNER
  ADMIN
  EDITOR
  SPECTATOR
}

type Board {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  myRole: RoleExtended!
  owner: User!
  admins: [User!]!
  editors: [User!]!
  spectators: [User!]!
  # returns null only if you don't have admin rights
  pendingBoardShareCount: Int
  # returns null only if you don't have admin rights
  pendingBoardShares: [PendingBoardShare!]
  # returns null only if you don't have admin rights
  pendingOwnerChangeCount: Int
  # returns null only if you don't have admin rights
  pendingOwnerChanges: [PendingOwnerChange!]!
  name: String!
  avatar: BoardPicture!
  deviceCount: Int
  devices: [Device!]!
  notificationCount: Int!
  index: Int!
  muted: Boolean!
}

type PendingBoardShare {
  id: ID!
  sender: User!
  receiver: User!
  role: Role!
  board: Board!
}

type PendingOwnerChange {
  id: ID!
  formerOwner: User!
  newOwner: User!
  board: Board!
}

type PermanentToken {
  id: ID!
  user: User!
  name: String!

  # lastUsed=null if never used
  lastUsed: DateTime
}

type Device {
  id: ID!
  index: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
  # Product name, for example Igloo Thermostat
  deviceType: String
  # Custom name gave by the end-user to the device
  name: String
  values: [Value!]!
  board: Board!
  notifications: [Notification!]!
  notificationCount: Int!
  online: Boolean
  signalStatus: Float
  batteryStatus: Float
  batteryCharging: Boolean
  firmware: String
  muted: Boolean!
}

enum ValuePermission {
  READ_ONLY
  READ_WRITE
}

enum ValueVisibility {
  VISIBLE
  HIDDEN
  INVISIBLE
}

enum TileSize {
  NORMAL
  WIDE
  TALL
  LARGE
}

type Notification {
  id: ID!
  device: Device!
  board: Board!
  user: User!
  content: String!
  date: DateTime!
  visualized: Boolean!
}

type PlotNode {
  id: ID!
  device: Device!
  plot: PlotValue!
  user: User!
  timestamp: DateTime!
  value: Float!
}

type StringPlotNode {
  id: ID!
  device: Device!
  plot: StringPlotValue!
  user: User!
  timestamp: DateTime!
  value: String!
}

type Map {
  id: ID!
  deviceValue: Value!
  zoom: Int!
  position: MapPosition!
  geoJSON: Json!
}

type MapPosition {
  id: ID!
  latitude: Float!
  longitude: Float!
  map: Map!
}

interface Value {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  board: Board!
  permission: ValuePermission!
  visibility: ValueVisibility!
  valueDetails: String
  tileSize: TileSize!
  name: String
  index: Int
}

type FloatValue implements Value {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  board: Board!
  permission: ValuePermission!
  visibility: ValueVisibility!
  valueDetails: String
  value: Float!
  # used when the end-user reads or modifies the value
  precision: Float
  # [min, max]
  boundaries: [Float!]
  tileSize: TileSize!
  index: Int
  name: String
}

type StringValue implements Value {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  board: Board!
  permission: ValuePermission!
  visibility: ValueVisibility!
  valueDetails: String
  value: String!
  maxChars: Int
  tileSize: TileSize!
  index: Int
  name: String
  allowedValues: [String!]
}

type PlotValue implements Value {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  board: Board!
  permission: ValuePermission!
  visibility: ValueVisibility!
  valueDetails: String
  value: [PlotNode!]!
  # used when the end-user reads or modifies the value
  precision: Float
  # [min, max]
  boundaries: [Float!]
  tileSize: TileSize!
  name: String
  index: Int

  threshold: Float
}

type StringPlotValue implements Value {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  board: Board!
  permission: ValuePermission!
  visibility: ValueVisibility!
  valueDetails: String
  value: [StringPlotNode!]!
  tileSize: TileSize!
  name: String
  index: Int
  allowedValues: [String!]
}

type BooleanValue implements Value {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  board: Board!
  permission: ValuePermission!
  visibility: ValueVisibility!
  valueDetails: String
  value: Boolean!
  tileSize: TileSize!
  name: String
  index: Int
}

type MapValue implements Value {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  board: Board!
  permission: ValuePermission!
  visibility: ValueVisibility!
  valueDetails: String
  value: String
  latitude: Float
  longitude: Float
  height: Float
  tileSize: TileSize!
  name: String
  index: Int
}
