scalar DateTime

scalar Json

# Payload returned after signing up
type SignupUserPayload {
  # user id
  id: ID!
  # token used to authenticate, pass it as a bearer in the authentication header
  token: String!
}

# Payload returned when authenticating
type AuthenticateUserPayload {
  # user id
  id: ID!
  # token used to authenticate, pass it as a bearer in the authentication header
  token: String!
}

# Data needed to display the QR code when upgrading to 2-Factor Authentication
type UpgradeTo2FactorPayload {
  # totp secret
  secret: String
  # svg for the qr code
  qrCode: String
}

# All available mutations
type Mutation {
  # Gets an authentication token
  AuthenticateUser(
    email: String!
    password: String!
    twoFactorCode: String # include only if 2-Factor Authentication is active
  ): AuthenticateUserPayload

  # Generates a permanent access token
  GeneratePermanentAccessToken(
    customName: String! # name of the token
  ): AuthenticateUserPayload

  # removes a permanent access token
  DeletePermanentAccesToken(id: ID!): ID

  # Creates a new account
  SignupUser(email: String!, password: String!): SignupUserPayload

  # Upgrades a user to 2 factor authentication
  UpgradeTo2FactorAuthentication: UpgradeTo2FactorPayload

  # Changes the password of the authenticated user
  ChangePassword(newPassword: String!): AuthenticateUserPayload

  # Creates a new Device
  CreateDevice(
    # Product name, for example Igloo Thermostat
    deviceType: String
    # Custom name gave by the end-user to the device
    customName: String
    tags: [String!]
    # device icon, shown in Igloo Aurora
    icon: String
    # used to sort the devices in Igloo Aurora
    index: Int
  ): Device

  # Creates a new notification
  CreateNotification(
    # device associated with the notification
    deviceId: ID!
    content: String! # optional if you want to change the date # date: DateTime
  ): Notification

  # Creates a new FloatValue
  CreateFloatValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance!
    # additional details about the value
    valueDetails: String
    value: Float!
    # used when displaying or changing the value in Igloo Aurora
    precision: Float
    # [min, max]
    boundaries: [Float!]
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
  ): FloatValue

  # Creates a StringValue
  CreateStringValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance!
    # additional details about the value
    valueDetails: String
    value: String!
    # max length of the string
    maxChars: Int
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # allowed values for the string
    allowedValues: [String!]
  ): StringValue

  # Creates a BooleanValue
  CreateBooleanValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance!
    # additional details about the value
    valueDetails: String
    value: Boolean!
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
  ): BooleanValue

  # Creates a ColourValue
  CreateColourValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance!
    # additional details about the value
    valueDetails: String
    # hex code
    value: String!
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # allowed colours
    allowedValues: [String!]
  ): ColourValue

  # Creates a MapValue
  CreateMapValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance!
    # additional details about the value
    valueDetails: String
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # GEOJson string
    value: String
    latitude: Float
    longitude: Float
    height: Float
  ): MapValue

  # Creates a new PlotValue
  CreatePlotValue(
    # device owning the value
    deviceId: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission!
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance!
    # additional details about the value
    valueDetails: String
    # used when the end-user reads or modifies the value
    precision: Float
    # [min, max]
    boundaries: [Float!]
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # alert threshold, values above the threshold will be displayed in red in Igloo Aurora
    threshold: Float
  ): PlotValue

  # Creates a new node in a plot
  CreatePlotNode(
    # id of the parent plot
    plotId: ID!
    # default is now
    timestamp: DateTime
    value: Float!
  ): PlotNode

  # Change user's data
  user(
    email: String
    timezone: String
    language: String
    # If active push notifications aren't sent
    quietMode: Boolean
    devMode: Boolean
    nightMode: Boolean
  ): User

  # changes device's data
  device(
    # device id
    id: ID!
    # Product name, for example Igloo Thermostat
    deviceType: String
    # Custom name gave by the end-user to the device
    customName: String
    tags: [String!]
    # device icon, shown in Igloo Aurora
    icon: String
    # used to sort the devices in Igloo Aurora
    index: Int
  ): Device

  # changes floatValue's data
  floatValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance
    # additional details about the value
    valueDetails: String
    value: Float
    # used when displaying or changing the value in Igloo Aurora
    precision: Float
    # [min, max]
    boundaries: [Float!]
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
  ): FloatValue

  # changes stringValue's data
  stringValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance
    # additional details about the value
    valueDetails: String
    value: String
    # max length of the string
    maxChars: Int
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # allowed values for the string
    allowedValues: [String!]
  ): StringValue

  # changes booleanValue's data
  booleanValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance
    # additional details about the value
    valueDetails: String
    value: Boolean
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
  ): BooleanValue

  # changes colourValue's data
  colourValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance
    # additional details about the value
    valueDetails: String
    # hex code
    value: String
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # allowed colours
    allowedValues: [String!]
  ): ColourValue

  # changes mapValue's data
  mapValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance
    # additional details about the value
    valueDetails: String
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # GEOJson string
    value: String
    latitude: Float
    longitude: Float
    height: Float
  ): MapValue

  # changes plotValue's data
  plotValue(
    # value id
    id: ID!
    # whether the value should be READ_ONLY or READ_WRITE in Igloo Aurora
    permission: ValuePermission
    # whether the value should be VISIBLE, HIDDEN or INVISIBLE in Igloo Aurora
    relevance: ValueRelevance
    # additional details about the value
    valueDetails: String
    # used when the end-user reads or modifies the value
    precision: Float
    # [min, max]
    boundaries: [Float!]
    # name of the value, displayed in Igloo Aurora
    customName: String
    # tile size in Igloo Aurora
    tileSize: TileSize
    # alert threshold, values above the threshold will be displayed in red in Igloo Aurora
    threshold: Float
  ): PlotValue

  # change plotNode's data
  plotNode(
    # node's id
    id: ID!
    # node's value
    value: Float
    # node's timestamp
    timestamp: DateTime
  ): PlotNode

  # change notification's data
  notification(
    # notification's id
    id: ID!
    # notification's content
    content: String
    # notification's date
    date: DateTime
    # whether the notification has already been visualized
    visualized: Boolean
    snackbarVisualized: Boolean
  ): Notification

  # delete notification
  deleteNotification(id: ID!): ID
  # delte value
  deleteValue(id: ID!): ID
  # delte device
  deleteDevice(id: ID!): ID
  # delte user
  deleteUser(password: String!, twoFactorCode: String): ID
  # delte plot node
  deletePlotNode(id: ID!): ID
}

input DeviceFilter {
  OR: [DeviceFilter!]
  AND: [DeviceFilter!]
  customName: String
  deviceType: String
  tagsContain: String
}

type Query {
  # gets user's data
  user: User
  #  get's device's data
  device(id: ID!): Device
  # get's value's data
  value(id: ID!): Value
  # get notification's data
  notification(id: ID!): Notification

  verifyPassword(password: String!): Boolean

  allDevices: [Device]
  allValues: [Value]
  allNotifications: [Notification]
  allPlotNodes: [PlotNode]
  allMaps: [Map]
  allMapPositions: [MapPosition]
  allFloatValues: [FloatValue]
  allStringValues: [StringValue]
  allPlotValues: [PlotValue]
  allBooleanValues: [BooleanValue]
  allColourValues: [ColourValue]
  allMapValues: [MapValue]
}

type Subscription {
  # subscribes to device creations
  deviceCreated: Device
  # subscribes to value creations
  valueCreated: Value
  # subscribes to notification creations
  notificationCreated: Notification
  # subscribes to value updates
  userUpdated: User
  # subscribes to device updates
  deviceUpdated: Device
  # subscribes to value updates
  valueUpdated: Value
  # subscribes to notification updates
  notificationUpdated: Notification
  # subscribes to value deleted
  valueDeleted: ID
  # subscribes to device deleted
  deviceDeleted: ID
  # subscribes to notification deletes
  notificationDeleted: ID
  # keeps the device's status set as online
  keepOnline(deviceId: ID!): Boolean
}

type User {
  id: ID! @isUnique
  createdAt: DateTime!
  updatedAt: DateTime!
  email: String! @isUnique
  devices: [Device!]!
  values: [Value!]!
  notifications: [Notification!]!
  permanentTokens: [PermanentToken!]!
  quietMode: Boolean
  devMode: Boolean
  nightMode: Boolean
  language: String
  timezone: String
}

type PermanentToken {
  id: ID!
  user: User!
  customName: String!
}

type Device {
  id: ID! @isUnique
  index: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
  # Product name, for example Igloo Thermostat
  deviceType: String
  # Custom name gave by the end-user to the device
  customName: String
  tags: [String!]!
  values: [Value!]!
  user: User!
  icon: String
  notifications: [Notification!]!
  online: Boolean
}

enum ValuePermission {
  READ_ONLY
  READ_WRITE
}

enum ValueRelevance {
  VISIBLE
  HIDDEN
  INVISIBLE
}

enum TileSize {
  NORMAL
  WIDE
  TALL
  LARGE
}

type Notification {
  id: ID! @isUnique
  device: Device!
  user: User!
  content: String!
  date: DateTime!
  visualized: Boolean!
  snackbarVisualized: Boolean!
}

type PlotNode {
  id: ID! @isUnique
  device: Device!
  plot: PlotValue!
  user: User!
  timestamp: DateTime!
  value: Float!
}

type Map {
  id: ID! @isUnique
  deviceValue: Value!
  zoom: Int!
  position: MapPosition!
  geoJSON: Json!
}

type MapPosition {
  id: ID! @isUnique
  latitude: Float!
  longitude: Float!
  map: Map!
}

interface Value {
  id: ID! @isUnique
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  user: User!
  permission: ValuePermission! @defaultValue(value: READ_WRITE)
  relevance: ValueRelevance! @defaultValue(value: NORMAL)
  valueDetails: String
  tileSize: TileSize!
  customName: String
}

type FloatValue implements Value {
  id: ID! @isUnique
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  user: User!
  permission: ValuePermission! @defaultValue(value: READ_WRITE)
  relevance: ValueRelevance! @defaultValue(value: NORMAL)
  valueDetails: String
  value: Float!
  # used when the end-user reads or modifies the value
  precision: Float
  # [min, max]
  boundaries: [Float!]
  tileSize: TileSize!
  customName: String
}

type StringValue implements Value {
  id: ID! @isUnique
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  user: User!
  permission: ValuePermission! @defaultValue(value: READ_WRITE)
  relevance: ValueRelevance! @defaultValue(value: NORMAL)
  valueDetails: String
  value: String!
  maxChars: Int
  tileSize: TileSize!
  customName: String
  allowedValues: [String!]
}

type PlotValue implements Value {
  id: ID! @isUnique
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  user: User!
  permission: ValuePermission! @defaultValue(value: READ_WRITE)
  relevance: ValueRelevance! @defaultValue(value: NORMAL)
  valueDetails: String
  value: [PlotNode!]!
  # used when the end-user reads or modifies the value
  precision: Float
  # [min, max]
  boundaries: [Float!]
  tileSize: TileSize!
  customName: String

  threshold: Float
}

type BooleanValue implements Value {
  id: ID! @isUnique
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  user: User!
  permission: ValuePermission! @defaultValue(value: READ_WRITE)
  relevance: ValueRelevance! @defaultValue(value: NORMAL)
  valueDetails: String
  value: Boolean!
  tileSize: TileSize!
  customName: String
}

type ColourValue implements Value {
  id: ID! @isUnique
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  user: User!
  permission: ValuePermission! @defaultValue(value: READ_WRITE)
  relevance: ValueRelevance! @defaultValue(value: NORMAL)
  valueDetails: String
  # hex value prefixed with #
  value: String!
  tileSize: TileSize!
  customName: String
  allowedValues: [String!]
}

type MapValue implements Value {
  id: ID! @isUnique
  createdAt: DateTime!
  updatedAt: DateTime!
  device: Device!
  user: User!
  permission: ValuePermission! @defaultValue(value: READ_WRITE)
  relevance: ValueRelevance! @defaultValue(value: NORMAL)
  valueDetails: String
  value: String
  latitude: Float
  longitude: Float
  height: Float
  tileSize: TileSize!
  customName: String
}
